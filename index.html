<!DOCTYPE html>
<html lang="en">
<head>
   <!-- basic -->
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <!-- mobile metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="viewport" content="initial-scale=1, maximum-scale=1">
   <!-- site metas -->
   <title>Programaci√≥n lineal</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
   <meta name="author" content="">
   <!-- bootstrap css -->
   <link rel="stylesheet" href="css/bootstrap.min.css">
   <!-- style css -->
   <link rel="stylesheet" href="css/style.css">
   <!-- Responsive-->
   <link rel="stylesheet" href="css/responsive.css">
   <!-- Estilos personalizados -->
   <style>
      .btn-check:checked + .btn-outline-primary {
         background-color: #007bff !important;
         border-color: #007bff !important;
         color: white !important;
      }
      
      .opacity-50 {
         opacity: 0.5;
         pointer-events: none;
      }
      
      #camera-video {
         max-width: 100%;
         border-radius: 8px;
         box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }
      
      #preview-img {
         box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }
      
      .card-header h6 {
         margin: 0;
         font-weight: 600;
      }
      
      .spinner-border {
         width: 2rem;
         height: 2rem;
      }
      
      #text-input {
         font-family: 'Courier New', monospace;
         font-size: 14px;
      }
      
      .btn-group .btn {
         border-radius: 0;
      }
      
      .btn-group .btn:first-child {
         border-top-left-radius: 0.375rem;
         border-bottom-left-radius: 0.375rem;
      }
      
      .btn-group .btn:last-child {
         border-top-right-radius: 0.375rem;
         border-bottom-right-radius: 0.375rem;
      }
      
      .alert-success {
         border-color: #28a745;
         background-color: #d4edda;
      }
      
      @media (max-width: 768px) {
         .btn-group {
            flex-direction: column;
         }
         
         .btn-group .btn {
            border-radius: 0.375rem !important;
            margin-bottom: 5px;
         }
         
         .btn-group .btn:last-child {
            margin-bottom: 0;
         }
      }

      /* === ESTILOS PARA SECCI√ìN DE ESTAD√çSTICAS === */
      .estadisticas-card {
         border: none;
         border-radius: 15px;
         box-shadow: 0 8px 25px rgba(15, 152, 248, 0.1);
         transition: transform 0.3s ease, box-shadow 0.3s ease;
         overflow: hidden;
      }

      .estadisticas-card:hover {
         transform: translateY(-5px);
         box-shadow: 0 12px 35px rgba(15, 152, 248, 0.15);
      }

      .estadisticas-card .card-header {
         background: linear-gradient(135deg, #0f98f8 0%, #0d7dd6 100%);
         border: none;
         padding: 20px;
         position: relative;
      }

      .estadisticas-card .card-header::after {
         content: '';
         position: absolute;
         bottom: 0;
         left: 0;
         right: 0;
         height: 3px;
         background: rgba(255, 255, 255, 0.2);
      }

      .estadisticas-card .card-header h6 {
         color: white;
         font-weight: 700;
         font-size: 1rem;
         text-transform: uppercase;
         letter-spacing: 0.5px;
         margin: 0;
      }

      .estadisticas-card .card-body {
         padding: 25px 20px;
         background: #fafbfc;
      }

      /* Resumen visual mejorado */
      .resumen-estadistico {
         background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
         border-radius: 15px;
         padding: 30px 20px;
         box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .valor-estadistico {
         font-family: 'Poppins', sans-serif;
         font-weight: 800;
         font-size: 2.5rem;
         line-height: 1;
         margin-bottom: 5px;
         text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .etiqueta-estadistico {
         font-family: 'Poppins', sans-serif;
         font-weight: 600;
         font-size: 0.85rem;
         text-transform: uppercase;
         letter-spacing: 0.8px;
         opacity: 0.7;
      }

      .valor-x1 { color: #0f98f8; }
      .valor-x2 { color: #28a745; }
      .valor-z { color: #fd7e14; }

      /* T√≠tulos de gr√°ficas con iconos mejorados */
      .titulo-grafica {
         display: flex;
         align-items: center;
         gap: 10px;
      }

      .icono-grafica {
         font-size: 1.2rem;
         opacity: 0.9;
      }

      /* Efectos hover para las cards */
      .card-grafica {
         transition: all 0.3s ease;
         border: 1px solid rgba(15, 152, 248, 0.1);
      }

      .card-grafica:hover {
         border-color: rgba(15, 152, 248, 0.3);
         box-shadow: 0 8px 25px rgba(15, 152, 248, 0.1);
      }

      /* Gradientes suaves para headers */
      .header-variables {
         background: linear-gradient(135deg, #0f98f8 0%, #4dabf7 100%);
      }

      .header-contribucion {
         background: linear-gradient(135deg, #28a745 0%, #51cf66 100%);
      }

      .header-sensibilidad {
         background: linear-gradient(135deg, #17a2b8 0%, #4ecdc4 100%);
      }

      .header-resumen {
         background: linear-gradient(135deg, #fd7e14 0%, #ffa94d 100%);
      }

      @media (max-width: 768px) {
         .valor-estadistico {
            font-size: 2rem;
         }
         
         .resumen-estadistico {
            padding: 20px 15px;
         }
         
         .estadisticas-card .card-body {
            padding: 20px 15px;
         }
      }
   </style>
   <!-- fevicon -->
   <!-- Scrollbar Custom CSS -->
   <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
   <!-- Tweaks for older IEs-->
   <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
   <!-- Chart.js for graphics -->
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <!--[if lt IE 9]>
   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->
</head>
<body class="main-layout">

<!-- loader -->
<div class="loader_bg">
   <div class="loader"><img src="images/loading.gif" alt="#" /></div>
</div>

<!-- Sidebar -->
<div id="mySidepanel" class="sidepanel">
   <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">√ó</a>
   <a href="index.html">Inicio</a>
   <a href="#about">Sobre Nosotros</a>
   <a href="#service">¬øQu√© encontraras aqu√≠?</a>
   <a href="#problemas">Ejercicios</a>

  
</div>

<!-- Header -->
<header>
   <div class="header">
      <div class="container-fluid">
         <div class="row">
            <div class="col-md-4 col-sm-4">
               <div class="logo">
                  <a href="index.html"><img src="images/UIDE-R-web.png" alt="#" /></a>
               </div>
            </div>
            <div class="col-md-8 col-sm-8">
               <div class="right_bottun">
                  <button class="openbtn" onclick="openNav()"><img src="images/menu_icon.png" alt="#"/> </button>
               </div>
            </div>
         </div>
      </div>
   </div>
</header>

<!-- Banner -->
<section class="banner_main">
   <div id="banner1" class="carousel slide banner_slide" data-ride="carousel">
      <div class="carousel-inner">
         <div class="carousel-item active">
            <div class="container-fluid">
               <div class="carousel-caption">
                  <div class="row">
                     <div class="col-md-7 col-lg-5">
                        <div class="text-bg">
                           <h1>Problemas de programaci√≥n lineal</h1>
                           <span>Aprende observando c√≥mo se resuelve un ejercicio desde cero hasta encontrar la soluci√≥n √≥ptima.
                              Te mostramos los c√°lculos, los puntos factibles y la l√≥gica detr√°s de cada paso.</span>
                        </div>
                     </div>
                     <div class="col-md-12 col-lg-7">
                        <div class="row">
                           <div class="col-md-6">
                              <div class="ban_track">
                                 <figure><img src="images/Confused-ahsocute.gif" alt="#"/></figure>
                              </div>
                           </div>
                           <div class="col-md-6">
                              <div class="text-bg">
                                 <span>¬øNo entiendes c√≥mo resolver un problema de programaci√≥n lineal?</span>
                                 <h3>Aqu√≠ ver√°s ejemplos reales explicados paso a paso. Sin complicaciones. Sin f√≥rmulas vac√≠as.</h3>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</section>

<!-- About -->
<div id="about" class="about ">
   <div class="container">
      <div class="row d_flex">
         <div class="col-md-6">
            <div class="about_right">
               <figure><img src="images/team-new.png" alt="#"/></figure>
            </div>
         </div>
         <div class="col-md-6">
            <div class="titlepage">
               <h2>Sobre Nosotros</h2>
               <p> Este proyecto lo creamos con el objetivo de ayudar a m√°s personas a entender c√≥mo se resuelve un problema de programaci√≥n lineal,
                  no solo mostrando el resultado, sino explicando todo el proceso paso a paso de una forma clara y visual. Detr√°s de esta idea estamos Eduardo Guerrero,
                  Luis Calvache y Yelena Jaramillo. Nos unimos para desarrollar una herramienta educativa que sirva como gu√≠a para estudiantes que est√°n aprendiendo este tema,
                  o que simplemente necesitan practicar con ejemplos reales ya resueltos. Lo hicimos pensando en quienes buscan una explicaci√≥n sencilla, directa y sin complicarse demasiado. <br>
                  Si este proyecto te sirve, ya cumplimos nuestro prop√≥sito.
               </p>
            </div>
         </div>
      </div>
   </div>
</div>

<!-- Service -->
<div id="service" class="service">
   <div class="container">
      <div class="row">
         <div class="col-md-10 offset-md-1">
            <div class="titlepage">
               <h2>Lo que encontrar√°s en esta plataforma</h2>
               <p>Creamos este sitio para que puedas aprender programaci√≥n lineal de forma clara, visual y pr√°ctica. Aqu√≠ no solo ves el resultado, sino el proceso completo paso a paso. </p>
            </div>
         </div>
      </div>
      <div class="row">
         <div class="col-md-12">
            <div class="service_main">
               <div class="service_box blu_colo">
                  <i><img src="images/ser1.png" alt="#"/></i>
                  <h4>Ejercicios resueltos</h4>
               </div>
               <div class="service_box yelldark_colo">
                  <i><img src="images/ser2.png" alt="#"/></i>
                  <h4>Paso a paso explicado</h4>
               </div>
               <div class="service_box yell_colo">
                  <i><img src="images/ser3.png" alt="#"/></i>
                  <h4> Interpretaci√≥n de resultados</h4>
               </div>
               <div class="service_box yelldark_colo">
                  <i><img src="images/ser4.png" alt="#"/></i>
                  <h4>Visualizaciones claras</h4>
               </div>
               <div class="service_box yell_colo">
                  <i><img src="images/ser5.png" alt="#"/></i>
                  <h4>Contenido educativo</h4>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

<!-- Choose Section -->
<div id="problemas" class="choose">
   <div class="container">
      <div class="row">
         <div class="col-md-12">
            <div class="titlepage">
               <h2>Resuelve tu Problema de Programaci√≥n Lineal</h2>
            </div>
         </div>
      </div>
      <div class="row">
         <!-- caqui va el codigo del problema -->
         <div class="col-md-12">
            <div class="card shadow-sm border-0">
               <div class="card-header bg-white py-3">
                  <h5 class="mb-0 text-primary">Ingresa tu problema</h5>
               </div>
               <div class="card-body">

                  <!-- Opciones de entrada -->
                  <div class="mb-4">
                     <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="inputMethod" id="manual" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="manual">Entrada Manual</label>
                        
                        <input type="radio" class="btn-check" name="inputMethod" id="text" autocomplete="off">
                        <label class="btn btn-outline-primary" for="text">Desde Texto</label>
                        
                        <input type="radio" class="btn-check" name="inputMethod" id="image" autocomplete="off">
                        <label class="btn btn-outline-primary" for="image">Desde Imagen</label>
                     </div>
                  </div>

                  <!-- Secci√≥n de imagen -->
                  <div id="image-section" class="d-none mb-4">
                     <div class="card border-info">
                        <div class="card-header bg-info text-white">
                           <h6 class="mb-0">üì∑ Reconocimiento de Imagen</h6>
                        </div>
                        <div class="card-body">
                           <div class="row">
                              <div class="col-md-6">
                                 <label class="form-label">Subir imagen del problema:</label>
                                 <input type="file" id="image-upload" class="form-control" accept="image/*">
                                 <small class="form-text text-muted">Formatos: JPG, PNG, PDF</small>
                              </div>
                              <div class="col-md-6">
                                 <label class="form-label">O tomar foto:</label>
                                 <button type="button" id="camera-btn" class="btn btn-info w-100">
                                    üì∏ Abrir C√°mara
                                 </button>
                                 <video id="camera-video" class="d-none w-100 mt-2" autoplay playsinline></video>
                                 <button type="button" id="capture-btn" class="btn btn-success w-100 mt-2 d-none">
                                    üì∑ Capturar Foto
                                 </button>
                              </div>
                           </div>
                           
                           <!-- Vista previa de imagen -->
                           <div id="image-preview" class="mt-3 d-none">
                              <h6>Vista previa:</h6>
                              <img id="preview-img" class="img-fluid border rounded" style="max-height: 300px;">
                              <div class="mt-2">
                                 <button type="button" id="process-image" class="btn btn-success">
                                    üîç Procesar Autom√°ticamente
                                 </button>
                                 <button type="button" id="clear-image" class="btn btn-secondary">
                                    üóëÔ∏è Limpiar
                                 </button>
                              </div>
                           </div>

                           <!-- Estado del procesamiento -->
                           <div id="processing-status" class="d-none">
                              <div class="text-center">
                                 <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">Procesando...</span>
                                 </div>
                                 <p class="mt-2">Reconociendo texto en la imagen...</p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

                  <!-- Secci√≥n de texto -->
                  <div id="text-section" class="d-none mb-4">
                     <div class="card border-success">
                        <div class="card-header bg-success text-white">
                           <h6 class="mb-0">üìù Reconocimiento por Texto</h6>
                        </div>
                        <div class="card-body">
                           <div class="mb-3">
                              <label class="form-label">Pega o escribe tu problema de programaci√≥n lineal:</label>
                              <textarea id="text-input" class="form-control" rows="8" placeholder="Pega aqu√≠ tu problema. Ejemplo:

Tucker Inc. fabrica trajes y sacos sport. Cada traje requiere 1.2 horas de corte y 0.7 horas de costura, utiliza 6 yardas de tela y proporciona $190 de utilidad. Cada saco requiere 0.8 horas de corte y 0.6 horas de costura, utiliza 4 yardas de tela y proporciona $150 de utilidad. Se dispone de 200 horas de corte, 180 horas de costura y 1200 yardas de tela. La producci√≥n m√≠nima es de 100 trajes y 75 sacos.

Tambi√©n acepta formato matem√°tico:
Maximizar Z = 3X1 + 2X2
Sujeto a: 2X1 + X2 <= 20
          X1 + 2X2 <= 16"></textarea>
                           </div>
                           
                           <div class="mt-3">
                              <button type="button" id="parse-text" class="btn btn-success">
                                 ‚öôÔ∏è Interpretar Problema
                              </button>
                              <button type="button" id="clear-text" class="btn btn-secondary">
                                 üóëÔ∏è Limpiar
                              </button>
                              <button type="button" id="load-example" class="btn btn-info">
                                 üìã Cargar Ejemplo
                              </button>
                           </div>

                           <!-- Resultado del reconocimiento de texto -->
                           <div id="text-result" class="mt-3 d-none">
                              <div class="alert alert-success">
                                 <h6>‚úÖ Problema interpretado correctamente</h6>
                                 <p id="parsed-summary" class="mb-0"></p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

                  <!-- Formulario -->
                  <form id="pl-form">
                     <div class="mb-3">
                        <label class="form-label">Objetivo:</label>
                        <select id="objetivo" class="form-control" required>
                           <option value="max">Maximizar</option>
                           <option value="min">Minimizar</option>
                        </select>
                     </div>

                     <div class="mb-3">
                        <label class="form-label">Funci√≥n Objetivo Z = c‚ÇÅX‚ÇÅ + c‚ÇÇX‚ÇÇ</label>
                        <div class="row g-2">
                           <div class="col-md-6">
                              <input type="number" id="c1" class="form-control" placeholder="Coeficiente X‚ÇÅ" step="any" required>
                           </div>
                           <div class="col-md-6">
                              <input type="number" id="c2" class="form-control" placeholder="Coeficiente X‚ÇÇ" step="any" required>
                           </div>
                        </div>
                     </div>

                     <div id="restricciones">
                        <label class="form-label">Restricciones (a‚ÇÅX‚ÇÅ + a‚ÇÇX‚ÇÇ ‚â§, ‚â•, = b)</label>
                        <div class="input-row mb-2 d-flex align-items-center">
                           <div class="col-3">
                              <input type="number" class="form-control coef" placeholder="a‚ÇÅ" step="any" required>
                           </div>
                           <div class="col-3">
                              <input type="number" class="form-control coef" placeholder="a‚ÇÇ" step="any" required>
                           </div>
                           <div class="col-2">
                              <select class="form-control sign">
                                 <option value="<=">‚â§</option>
                                 <option value=">=">‚â•</option>
                                 <option value="=">=</option>
                              </select>
                           </div>
                           <div class="col-3">
                              <input type="number" class="form-control rhs" placeholder="b" step="any" required>
                           </div>
                           <div class="col-1 d-flex align-items-center">
                              <button type="button" class="btn btn-danger btn-sm w-100" onclick="this.closest('.input-row').remove()">X</button>
                           </div>
                        </div>
                     </div>

                     <div class="mt-3">
                        <button type="button" onclick="agregarRestriccion()" class="btn btn-outline-primary btn-sm">+ Agregar</button>
                        <button type="button" onclick="resolverProblema()" class="btn btn-success btn-sm">Resolver</button>
                        <button type="button" onclick="limpiarFormulario()" class="btn btn-warning btn-sm text-white">Limpiar</button>
                     </div>
                  </form>

                  <!-- Resultados -->
                  <div id="resultados" class="d-none mt-4">
                     <div class="accordion" id="acordeonPasos">

                        <!-- Paso 1 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button" type="button" data-toggle="collapse" data-target="#paso1">
                                 Paso 1: Problema Ingresado
                              </button>
                           </h2>
                           <div id="paso1" class="accordion-collapse collapse show" data-parent="#acordeonPasos">
                              <div class="accordion-body">
                                 <p><strong>Objetivo:</strong> <span id="objetivo-out"></span></p>
                                 <p><strong>Funci√≥n Objetivo:</strong> <span id="funcion-out" class="badge bg-info text-white px-2 py-1">Z = ...</span></p>
                                 <p><strong>Sujeto a:</strong></p>
                                 <ul id="restricciones-out" class="list-group list-group-flush"></ul>
                              </div>
                           </div>
                        </div>

                        <!-- Paso 2 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso2">
                                 Paso 2: M√©todo Gr√°fico
                              </button>
                           </h2>
                           <div id="paso2" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body">
                                 <canvas id="grafico" class="w-100 border rounded" style="height:400px;"></canvas>
                                 <p id="punto-optimo" class="mt-2 text-success fw-bold"></p>
                              </div>
                           </div>
                        </div>

                        <!-- Paso 3 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso3">
                                 Paso 3: M√©todo Simplex
                              </button>
                           </h2>
                           <div id="paso3" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body" id="simplex-steps"></div>
                           </div>
                        </div>

                        <!-- Paso 4 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso4">
                                 Paso 4: Soluci√≥n √ìptima
                              </button>
                           </h2>
                           <div id="paso4" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body">
                                 <div class="row">
                                    <div class="col-md-4"><p><strong>X‚ÇÅ =</strong> <span id="x1-opt"></span></p></div>
                                    <div class="col-md-4"><p><strong>X‚ÇÇ =</strong> <span id="x2-opt"></span></p></div>
                                    <div class="col-md-4"><p><strong>Z =</strong> <span id="z-opt"></span></p></div>
                                 </div>
                              </div>
                           </div>
                        </div>

                        <!-- Paso 5 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso5">
                                 Paso 5: An√°lisis de Sensibilidad
                              </button>
                           </h2>
                           <div id="paso5" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body" id="sensibilidad"></div>
                           </div>
                        </div>

                        <!-- Paso 6 -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso6">
                                 Paso 6: Interpretaci√≥n
                              </button>
                           </h2>
                           <div id="paso6" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body" id="interpretacion"></div>
                           </div>
                        </div>

                        <!-- Paso 7 - Gr√°ficas de Resultados -->
                        <div class="accordion-item">
                           <h2 class="accordion-header">
                              <button class="accordion-button collapsed" type="button" data-toggle="collapse" data-target="#paso7">
                                 Paso 7: Gr√°ficas de Resultados
                              </button>
                           </h2>
                           <div id="paso7" class="accordion-collapse collapse" data-parent="#acordeonPasos">
                              <div class="accordion-body">
                                 <div class="row">
                                    <div class="col-md-6 mb-4">
                                       <div class="card estadisticas-card card-grafica">
                                          <div class="card-header header-variables">
                                             <div class="titulo-grafica">
                                                <span class="icono-grafica">üìä</span>
                                                <h6 class="mb-0">Valores √ìptimos de Variables</h6>
                                             </div>
                                          </div>
                                          <div class="card-body">
                                             <canvas id="grafico-variables" style="height: 300px;"></canvas>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                       <div class="card estadisticas-card card-grafica">
                                          <div class="card-header header-contribucion">
                                             <div class="titulo-grafica">
                                                <span class="icono-grafica">üí∞</span>
                                                <h6 class="mb-0">Contribuci√≥n por Variable</h6>
                                             </div>
                                          </div>
                                          <div class="card-body">
                                             <canvas id="grafico-contribucion" style="height: 300px;"></canvas>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="row">
                                    <div class="col-md-6 mb-4">
                                       <div class="card estadisticas-card card-grafica">
                                          <div class="card-header header-sensibilidad">
                                             <div class="titulo-grafica">
                                                <span class="icono-grafica">üìà</span>
                                                <h6 class="mb-0">An√°lisis de Sensibilidad</h6>
                                             </div>
                                          </div>
                                          <div class="card-body">
                                             <canvas id="grafico-sensibilidad" style="height: 300px;"></canvas>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                       <div class="card estadisticas-card card-grafica">
                                          <div class="card-header header-resumen">
                                             <div class="titulo-grafica">
                                                <span class="icono-grafica">üéØ</span>
                                                <h6 class="mb-0">Resumen de Resultados</h6>
                                             </div>
                                          </div>
                                          <div class="card-body">
                                             <div class="resumen-estadistico">
                                                <div class="row text-center">
                                                   <div class="col-4">
                                                      <div class="valor-estadistico valor-x1" id="valor-x1-display">0</div>
                                                      <div class="etiqueta-estadistico">X‚ÇÅ</div>
                                                   </div>
                                                   <div class="col-4">
                                                      <div class="valor-estadistico valor-x2" id="valor-x2-display">0</div>
                                                      <div class="etiqueta-estadistico">X‚ÇÇ</div>
                                                   </div>
                                                   <div class="col-4">
                                                      <div class="valor-estadistico valor-z" id="valor-z-display">0</div>
                                                      <div class="etiqueta-estadistico">Z √ìptimo</div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>

                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>



<!-- Footer -->
<footer>
   <div class="footer bottom_cross1">
     
      <div class="copyright">
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <p>2025-UIDE All Rights Reserved. Design by <a href="https://www.uide.edu.ec/">Eduardo Guerrero, Luis Calvache y Yelena Jaramillo</a></p>
               </div>
            </div>
         </div>
      </div>
   </div>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script src="js/custom.js"></script>
<script>
   function openNav() { document.getElementById("mySidepanel").style.width = "250px"; }
   function closeNav() { document.getElementById("mySidepanel").style.width = "0"; }

   // === FUNCIONALIDAD DE RECONOCIMIENTO ===
   let stream = null;

   // Cambio entre m√©todos de entrada
   $('input[name="inputMethod"]').on('change', function() {
      const method = $(this).attr('id');
      
      // Ocultar todas las secciones
      $('#image-section, #text-section').addClass('d-none');
      $('#pl-form').removeClass('opacity-50');
      stopCamera();
      
      // Mostrar la secci√≥n correspondiente
      if (method === 'image') {
         $('#image-section').removeClass('d-none');
         $('#pl-form').addClass('opacity-50');
      } else if (method === 'text') {
         $('#text-section').removeClass('d-none');
         $('#pl-form').addClass('opacity-50');
      }
   });

   // Subir archivo de imagen
   $('#image-upload').on('change', function(e) {
      const file = e.target.files[0];
      if (file) {
         const reader = new FileReader();
         reader.onload = function(e) {
            showImagePreview(e.target.result);
         };
         reader.readAsDataURL(file);
      }
   });

   // Abrir c√°mara
   $('#camera-btn').on('click', function() {
      navigator.mediaDevices.getUserMedia({ 
         video: { 
            width: { ideal: 1280 }, 
            height: { ideal: 720 },
            facingMode: 'environment'
         }
      })
      .then(function(mediaStream) {
         stream = mediaStream;
         const video = document.getElementById('camera-video');
         video.srcObject = stream;
         $('#camera-video').removeClass('d-none');
         $('#capture-btn').removeClass('d-none');
         $('#camera-btn').text('üìπ C√°mara Activa');
      })
      .catch(function(error) {
         alert('Error al acceder a la c√°mara: ' + error.message);
      });
   });

   // Capturar foto
   $('#capture-btn').on('click', function() {
      const video = document.getElementById('camera-video');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);
      const imageDataUrl = canvas.toDataURL('image/jpeg', 0.8);
      
      showImagePreview(imageDataUrl);
      stopCamera();
   });

   // Mostrar vista previa de imagen
   function showImagePreview(imageSrc) {
      $('#preview-img').attr('src', imageSrc);
      $('#image-preview').removeClass('d-none');
   }

   // Detener c√°mara
   function stopCamera() {
      if (stream) {
         stream.getTracks().forEach(track => track.stop());
         stream = null;
         $('#camera-video').addClass('d-none');
         $('#capture-btn').addClass('d-none');
         $('#camera-btn').text('üì∏ Abrir C√°mara');
      }
   }

   // Limpiar imagen
   $('#clear-image').on('click', function() {
      $('#image-preview').addClass('d-none');
      $('#image-upload').val('');
      stopCamera();
   });

   // Procesar imagen autom√°ticamente con OCR y parseado
   $('#process-image').on('click', function() {
      const imgSrc = $('#preview-img').attr('src');
      if (!imgSrc) {
         showErrorMessage('Por favor selecciona una imagen primero');
         return;
      }

      $('#processing-status').removeClass('d-none');
      $('#process-image').prop('disabled', true);

      // Configurar Tesseract con mejores opciones
      Tesseract.recognize(
         imgSrc,
         'eng',
         {
            logger: m => {
               if (m.status === 'recognizing text') {
                  const progress = Math.round(m.progress * 100);
                  $('#processing-status p').text(`Reconociendo texto... ${progress}%`);
               }
            }
         }
      )
      .then(({ data: { text } }) => {
         console.log('Texto reconocido desde imagen:', text);
         
         if (!text || text.trim().length < 5) {
            $('#processing-status').addClass('d-none');
            $('#process-image').prop('disabled', false);
            showErrorMessage('No se detect√≥ texto suficiente en la imagen. Intenta con una imagen m√°s clara o usa la entrada manual.');
            return;
         }

         // Cambiar mensaje de estado
         $('#processing-status p').text('Interpretando problema...');
         
         // Intentar parsear autom√°ticamente
         try {
            const problem = parseProblemFromText(text);
            
            if (problem) {
               // ¬°√âxito! Llenar formulario autom√°ticamente
               fillFormWithProblem(problem);
               
               $('#processing-status').addClass('d-none');
               $('#process-image').prop('disabled', false);
               
               // Mostrar mensaje de √©xito y cambiar a manual
               showSuccessMessage(`¬°Problema interpretado autom√°ticamente desde imagen!
                  Objetivo: ${problem.objective === 'max' ? 'Maximizar' : 'Minimizar'} Z = ${problem.c1}X‚ÇÅ + ${problem.c2}X‚ÇÇ
                  Restricciones: ${problem.constraints.length} encontradas
                  El formulario se ha llenado autom√°ticamente.`);
               
               // Cambiar a entrada manual para mostrar resultado
               setTimeout(() => {
                  $('#manual').prop('checked', true);
                  $('#image-section').addClass('d-none');
                  $('#pl-form').removeClass('opacity-50');
               }, 2000);
               
            } else {
               // No se pudo interpretar autom√°ticamente - ir a entrada manual con el texto
               $('#processing-status').addClass('d-none');
               $('#process-image').prop('disabled', false);
               
               // Llenar el √°rea de texto y cambiar a esa secci√≥n
               $('#text-input').val(text);
               $('#text').prop('checked', true);
               $('#image-section').addClass('d-none');
               $('#text-section').removeClass('d-none');
               $('#pl-form').addClass('opacity-50');
               
               showSuccessMessage('Texto reconocido desde imagen. Se ha copiado a "Desde Texto" para que puedas editarlo y volver a interpretar si es necesario.');
            }
            
         } catch (error) {
            console.error('Error al interpretar desde imagen:', error);
            $('#processing-status').addClass('d-none');
            $('#process-image').prop('disabled', false);
            
            // En caso de error, tambi√©n copiar a texto
            $('#text-input').val(text);
            $('#text').prop('checked', true);
            $('#image-section').addClass('d-none');
            $('#text-section').removeClass('d-none');
            $('#pl-form').addClass('opacity-50');
            
            showErrorMessage('No se pudo interpretar autom√°ticamente. El texto se ha copiado a "Desde Texto" para que puedas revisarlo y editarlo.');
         }
      })
      .catch(error => {
         console.error('Error OCR:', error);
         $('#processing-status').addClass('d-none');
         $('#process-image').prop('disabled', false);
         showErrorMessage('Error al procesar la imagen. Intenta con otra imagen m√°s clara o usa la entrada manual.');
      });
   });

   // === FUNCIONALIDAD DE TEXTO DIRECTO ===
   
   // Interpretar problema desde texto directo
   $('#parse-text').on('click', function() {
      const inputText = $('#text-input').val().trim();
      
      if (!inputText) {
         alert('Por favor ingresa el texto del problema');
         return;
      }
      
      try {
         const problem = parseProblemFromText(inputText);
         
         if (problem) {
            fillFormWithProblem(problem);
            
            // Mostrar resumen detallado
            let summary = `<strong>Objetivo:</strong> ${problem.objective === 'max' ? 'Maximizar' : 'Minimizar'} Z = ${problem.c1}X‚ÇÅ + ${problem.c2}X‚ÇÇ<br>
                          <strong>Restricciones:</strong> ${problem.constraints.length} encontradas<br>`;
            
            if (problem.interpretation) {
               summary += `<strong>Interpretaci√≥n:</strong> ${problem.interpretation}<br>`;
            }
            
            // Mostrar restricciones
            summary += '<strong>Restricciones detectadas:</strong><ul>';
            problem.constraints.forEach((constraint, i) => {
               summary += `<li>${constraint.a1}X‚ÇÅ + ${constraint.a2}X‚ÇÇ ${constraint.sign} ${constraint.b}</li>`;
            });
            summary += '</ul>';
            
            $('#parsed-summary').html(summary);
            $('#text-result').removeClass('d-none');
            
            // Mostrar mensaje de √©xito
            showSuccessMessage('¬°Problema interpretado correctamente! Revisa los valores en el formulario y ajusta si es necesario.');
            
            // Cambiar a entrada manual despu√©s de un momento
            setTimeout(() => {
               $('#manual').prop('checked', true);
               $('#text-section').addClass('d-none');
               $('#pl-form').removeClass('opacity-50');
            }, 3000);
            
         } else {
            showErrorMessage('No se pudo interpretar el problema autom√°ticamente. Intenta con un formato m√°s claro o revisa que incluya:\n\n‚Ä¢ Dos productos o variables\n‚Ä¢ Costos o utilidades de cada producto\n‚Ä¢ Restricciones de recursos\n‚Ä¢ L√≠mites de producci√≥n (opcional)');
         }
      } catch (error) {
         showErrorMessage('Error al interpretar el problema: ' + error.message);
      }
   });

   // Limpiar texto
   $('#clear-text').on('click', function() {
      $('#text-input').val('');
      $('#text-result').addClass('d-none');
   });

   // Cargar ejemplo de Tucker Inc.
   $('#load-example').on('click', function() {
      const exampleText = `Tucker Inc. fabrica trajes de alta calidad y sacos sport para hombre. Cada traje requiere 1.2 horas de tiempo de corte y 0.7 horas de tiempo de costura, utiliza 6 yardas de tela y proporciona una contribuci√≥n a las utilidades de $190. Cada saco sport requiere 0.8 horas de tiempo de corte y 0.6 horas de tiempo de costura, utiliza 4 yardas de tela y proporciona una contribuci√≥n a las utilidades de $150. Para la semana siguiente se dispone de 200 horas de tiempo de corte, 180 horas de tiempo de costura y 1200 yardas de tela. Los requerimientos de marketing especifican una producci√≥n m√≠nima de 100 trajes y 75 sacos sport.`;
      
      $('#text-input').val(exampleText);
      $('#text-result').addClass('d-none');
      showSuccessMessage('Ejemplo cargado. Presiona "Interpretar Problema" para ver c√≥mo funciona el reconocimiento de lenguaje natural.');
   });


   // Funci√≥n auxiliar para llenar el formulario
   function fillFormWithProblem(problem) {
      // Llenar formulario autom√°ticamente
      $('#objetivo').val(problem.objective);
      $('#c1').val(problem.c1);
      $('#c2').val(problem.c2);
      
      // Limpiar restricciones existentes
      $('#restricciones').html(`
         <label class="form-label">Restricciones (a‚ÇÅX‚ÇÅ + a‚ÇÇX‚ÇÇ ‚â§, ‚â•, = b)</label>
      `);
      
      // Agregar restricciones reconocidas
      problem.constraints.forEach(constraint => {
         const div = document.createElement('div');
         div.className = 'input-row mb-2 d-flex align-items-center';
         div.innerHTML = `
            <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÅ" value="${constraint.a1}" step="any" required></div>
            <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÇ" value="${constraint.a2}" step="any" required></div>
            <div class="col-2">
               <select class="form-control sign">
                  <option value="<=" ${constraint.sign === '<=' ? 'selected' : ''}>‚â§</option>
                  <option value=">=" ${constraint.sign === '>=' ? 'selected' : ''}>‚â•</option>
                  <option value="=" ${constraint.sign === '=' ? 'selected' : ''}>=</option>
               </select>
            </div>
            <div class="col-3"><input type="number" class="form-control rhs" placeholder="b" value="${constraint.b}" step="any" required></div>
            <div class="col-1 d-flex align-items-center">
               <button type="button" class="btn btn-danger btn-sm w-100" onclick="this.closest('.input-row').remove()">X</button>
            </div>
         `;
         document.getElementById('restricciones').appendChild(div);
      });
   }

   // Parser universal para problemas de programaci√≥n lineal
   function parseProblemFromText(text) {
      try {
         console.log('=== PARSER UNIVERSAL INICIADO ===');
         console.log('Texto a parsear:', text);
         
         // Primero intentar con formato matem√°tico simple
         const mathResult = parseSimpleMathFormat(text);
         if (mathResult) return mathResult;
         
         // Intentar parser general para cualquier problema narrativo
         const generalResult = parseGeneralNarrativeFormat(text);
         if (generalResult) return generalResult;
         
         // Como √∫ltimo recurso, intentar el parser espec√≠fico de Tucker
         return parseNarrativeFormat(text);
         
      } catch (error) {
         console.error('Error parsing problem:', error);
         return null;
      }
   }

   // Parser para formato matem√°tico simple (Z = ax1 + bx2, etc.)
   function parseSimpleMathFormat(text) {
      try {
         let normalizedText = text.toLowerCase()
            .replace(/maximizar|max\s*:|max|m√°x/gi, 'max')
            .replace(/minimizar|min\s*:|min|m√≠n/gi, 'min')
            .replace(/[x|X]‚ÇÅ|[x|X]1/gi, 'x1')
            .replace(/[x|X]‚ÇÇ|[x|X]2/gi, 'x2')
            .replace(/‚â§/g, '<=')
            .replace(/‚â•/g, '>=');
         
         const isMaximize = /max/i.test(normalizedText);
         const objective = isMaximize ? 'max' : 'min';
         
         let c1 = 1, c2 = 1;
         let objMatch = normalizedText.match(/z\s*=\s*([+-]?\d*\.?\d*)\s*x1\s*([+-])\s*([+-]?\d*\.?\d*)\s*x2/i);
         
         if (objMatch) {
            c1 = parseFloat(objMatch[1]) || 1;
            const sign = objMatch[2];
            c2 = parseFloat(objMatch[3]) || 1;
            if (sign === '-') c2 = -c2;
         } else {
            return null; // No es formato matem√°tico simple
         }
         
         const constraints = [];
         const lines = normalizedText.split('\n');
         
         for (let line of lines) {
            line = line.trim();
            if (!line || /max|min|z\s*=/i.test(line) || line.length < 3) continue;
            
            let constraintMatch = line.match(/([+-]?\d*\.?\d*)\s*x1\s*([+-])\s*([+-]?\d*\.?\d*)\s*x2\s*([<>=!]+)\s*([+-]?\d+\.?\d*)/);
            
            if (constraintMatch) {
               let a1 = parseFloat(constraintMatch[1]) || 1;
               const sign1 = constraintMatch[2];
               let a2 = parseFloat(constraintMatch[3]) || 1;
               if (sign1 === '-') a2 = -a2;
               
               let sign = '<=';
               const signStr = constraintMatch[4];
               if (signStr.includes('>=')) sign = '>=';
               else if (signStr.includes('=') && !signStr.includes('<') && !signStr.includes('>')) sign = '=';
               
               const b = parseFloat(constraintMatch[5]) || 0;
               constraints.push({ a1, a2, sign, b });
            }
         }
         
         if (constraints.length > 0) {
            return { objective, c1, c2, constraints };
         }
         
         return null;
      } catch (error) {
         return null;
      }
   }

   // Parser completamente adaptativo para cualquier problema de programaci√≥n lineal
   function parseGeneralNarrativeFormat(text) {
      try {
         console.log('=== PARSER ADAPTATIVO UNIVERSAL ===');
         
         // Limpiar y normalizar texto
         let cleanText = cleanAndNormalizeText(text);
         console.log('Texto limpio:', cleanText.substring(0, 300) + '...');
         
         // Detectar contexto del problema
         const problemContext = detectProblemContext(cleanText);
         console.log('Contexto del problema:', problemContext);
         
         // Extraer variables de decisi√≥n
         const variables = extractDecisionVariables(cleanText, problemContext);
         console.log('Variables de decisi√≥n detectadas:', variables);
         
         if (variables.length < 2) {
            console.log('No se detectaron suficientes variables');
            return null;
         }
         
         // Extraer funci√≥n objetivo
         const objectiveFunction = extractObjectiveFunction(cleanText, variables, problemContext);
         console.log('Funci√≥n objetivo:', objectiveFunction);
         
         if (!objectiveFunction || !objectiveFunction.coefficients || objectiveFunction.coefficients.length < 2) {
            console.log('No se pudo extraer la funci√≥n objetivo');
            return null;
         }
         
         // Extraer todas las restricciones
         const allConstraints = extractAllConstraints(cleanText, variables, problemContext);
         console.log('Todas las restricciones:', allConstraints);
         
         if (allConstraints.length === 0) {
            console.log('No se encontraron restricciones');
            return null;
         }
         
         // Adaptar para interfaz de 2 variables (simplificado)
         const adaptedResult = adaptToTwoVariableInterface(objectiveFunction, allConstraints, variables, problemContext);
         
         console.log('Resultado adaptado:', adaptedResult);
         return adaptedResult;
         
      } catch (error) {
         console.error('Error en parser adaptativo:', error);
         return null;
      }
   }
   
   // Limpiar y normalizar texto
   function cleanAndNormalizeText(text) {
      return text.toLowerCase()
         // Normalizar caracteres
         .replace(/contribucion/g, 'contribuci√≥n')
         .replace(/operacion/g, 'operaci√≥n')
         .replace(/produccion/g, 'producci√≥n')
         .replace(/asignacion/g, 'asignaci√≥n')
         .replace(/solucion/g, 'soluci√≥n')
         .replace(/m√°ximo/g, 'maximo')
         .replace(/m√≠nimo/g, 'minimo')
         // Eliminar preguntas y an√°lisis (a., b., c., d.)
         .replace(/^[a-z]\.\s*.*/gmi, '')
         .replace(/¬ø.*?\?/g, '')
         .replace(/\?.*$/gm, '')
         // Limpiar texto innecesario
         .replace(/caso\s+practico.*/i, '')
         .replace(/universidad.*/i, '')
         .replace(/business\s+school.*/i, '')
         .replace(/apellidos.*:/i, '')
         .replace(/informe.*gerencial/i, '')
         // Normalizar espacios
         .replace(/\s+/g, ' ')
         .trim();
   }
   
   // Detectar contexto del problema mejorado
   function detectProblemContext(text) {
      const context = {
         type: 'general',
         industry: 'general',
         objective: 'max',
         domain: 'production'
      };
      
      // Detecci√≥n m√°s robusta de tipo de industria/contexto
      if (/portafolio|portfolio|inversion|inversi[√≥o]n|fondos?|acciones|rendimientos?|riesgo|cliente.*invertir|asigna.*fondos|williams|asesoria.*inversiones|firma.*asesoria/i.test(text)) {
         context.type = 'inversi√≥n';
         context.industry = 'financiera';
         context.domain = 'finance';
         console.log('Detectado: Problema de inversi√≥n/portafolio');
      } else if (/fabrica|manufactura|produce|trajes?|sacos?|tucker/i.test(text)) {
         context.type = 'producci√≥n';
         context.industry = 'textil';
         context.domain = 'manufacturing';
         console.log('Detectado: Problema de producci√≥n');
      } else if (/transporte|env[√≠i]o|distribucion|rutas?/i.test(text)) {
         context.type = 'transporte';
         context.domain = 'logistics';
         console.log('Detectado: Problema de transporte');
      } else if (/mezcla|combina|ingredientes/i.test(text)) {
         context.type = 'mezcla';
         context.domain = 'mixing';
         console.log('Detectado: Problema de mezcla');
      }
      
      // Detecci√≥n m√°s robusta de objetivo
      if (/minimiz|menor|minimo|reducir|disminuir/i.test(text)) {
         context.objective = 'min';
      } else if (/maximiz|mayor|maximo|utilidad|beneficio|rendimiento|optimo.*rendimiento|rendimiento.*maximo/i.test(text)) {
         context.objective = 'max';
      }
      
      console.log('Contexto detectado:', context);
      return context;
   }
   
   // Extraer variables de decisi√≥n mejorado
   function extractDecisionVariables(text, context) {
      const variables = [];
      console.log('Extrayendo variables para contexto:', context.type);
      
      if (context.type === 'inversi√≥n') {
         // Patrones m√°s espec√≠ficos para fondos - mejorados para Williams
         const fundPatterns = [
            /fondo.*(?:acciones.*)?crecimiento/gi,
            /fondo.*ingresos/gi,
            /fondo.*mercado.*dinero/gi,
            /fondo.*(?:de\s+)?crecimiento/gi,
            /acciones.*crecimiento/gi,
            /bonos/gi,
            /crecimiento/gi,
            /ingresos/gi,
            /mercado.*dinero/gi
         ];
         
         console.log('Buscando fondos en el texto...');
         
         // Buscar patrones espec√≠ficos del problema Williams
         if (/williams/i.test(text) || /tres.*opciones|3.*opciones/i.test(text)) {
            console.log('Detectado problema Williams - usando fondos espec√≠ficos');
            variables.push(
               { name: 'fondo crecimiento', type: 'inversi√≥n', unit: 'proporci√≥n' },
               { name: 'fondo ingresos', type: 'inversi√≥n', unit: 'proporci√≥n' },
               { name: 'mercado dinero', type: 'inversi√≥n', unit: 'proporci√≥n' }
            );
         } else {
            // Buscar fondos por patrones
            fundPatterns.forEach((pattern, index) => {
               const matches = [...new Set(text.match(pattern) || [])];
               console.log(`Patr√≥n ${index + 1} encontr√≥:`, matches);
               matches.forEach(match => {
                  if (!variables.some(v => v.name.includes(match.toLowerCase())) && variables.length < 3) {
                     variables.push({
                        name: match.toLowerCase().trim(),
                        type: 'inversi√≥n',
                        unit: 'cantidad invertida'
                     });
                  }
               });
            });
            
            // Si no encontramos fondos espec√≠ficos, buscar por contexto
            if (variables.length < 3) {
               console.log('No se encontraron fondos espec√≠ficos, usando contexto...');
               if (/tres.*fondos?|3.*fondos?/i.test(text)) {
                  variables.push(
                     { name: 'fondo crecimiento', type: 'inversi√≥n', unit: 'cantidad invertida' },
                     { name: 'fondo ingresos', type: 'inversi√≥n', unit: 'cantidad invertida' },
                     { name: 'fondo mercado dinero', type: 'inversi√≥n', unit: 'cantidad invertida' }
                  );
               } else if (/crecimiento.*ingresos.*mercado/i.test(text) || /fondos?.*crecimiento/i.test(text)) {
                  variables.push(
                     { name: 'crecimiento', type: 'inversi√≥n', unit: 'cantidad invertida' },
                     { name: 'ingresos', type: 'inversi√≥n', unit: 'cantidad invertida' },
                     { name: 'mercado dinero', type: 'inversi√≥n', unit: 'cantidad invertida' }
                  );
               }
            }
         }
      }
      
      if (context.type === 'producci√≥n') {
         // Buscar productos espec√≠ficos
         const productPatterns = [
            /trajes?/gi,
            /sacos?\s+sport/gi,
            /sacos?/gi,
            /producto\s+[a-z]/gi,
            /art[√≠i]culo\s+[a-z]/gi
         ];
         
         productPatterns.forEach(pattern => {
            const matches = [...new Set(text.match(pattern) || [])];
            matches.forEach(match => {
               if (!variables.some(v => v.name.includes(match.toLowerCase()))) {
                  variables.push({
                     name: match.toLowerCase(),
                     type: 'producci√≥n',
                     unit: 'unidades'
                  });
               }
            });
         });
         
         // Si encontramos horas extra, agregar como variable
         if (/horas?\s+extra/i.test(text)) {
            variables.push({
               name: 'horas extra',
               type: 'recurso adicional',
               unit: 'horas'
            });
         }
      }
      
      // Si no encontramos variables espec√≠ficas, usar gen√©ricas seg√∫n contexto
      if (variables.length === 0) {
         if (context.type === 'inversi√≥n') {
            variables.push(
               { name: 'inversi√≥n 1', type: 'general', unit: 'cantidad' },
               { name: 'inversi√≥n 2', type: 'general', unit: 'cantidad' },
               { name: 'inversi√≥n 3', type: 'general', unit: 'cantidad' }
            );
         } else {
            variables.push(
               { name: 'x1', type: 'general', unit: 'unidades' },
               { name: 'x2', type: 'general', unit: 'unidades' }
            );
         }
      }
      
      // Asegurar al menos 2 variables
      while (variables.length < 2) {
         variables.push({
            name: `x${variables.length + 1}`,
            type: 'general',
            unit: 'unidades'
         });
      }
      
      console.log('Variables extra√≠das:', variables);
      return variables;
   }
   
   // Extraer funci√≥n objetivo mejorado
   function extractObjectiveFunction(text, variables, context) {
      const objectiveFunction = {
         type: context.objective,
         coefficients: [],
         description: ''
      };
      
      console.log('Extrayendo funci√≥n objetivo para:', context.type);
      
      if (context.type === 'inversi√≥n') {
         // Patrones espec√≠ficos para Williams - buscar 18%, 12.5%, 7.5%
         if (/williams/i.test(text)) {
            console.log('Buscando rendimientos espec√≠ficos de Williams...');
            const williamsPattern = /(\d+\.?\d*)\s*%.*(\d+\.?\d*)\s*%.*(\d+\.?\d*)\s*%/i;
            const williamsMatch = williamsPattern.exec(text);
            
            if (williamsMatch) {
               const coefficients = [
                  parseFloat(williamsMatch[1]),
                  parseFloat(williamsMatch[2]),
                  parseFloat(williamsMatch[3])
               ];
               console.log('Rendimientos Williams encontrados:', coefficients);
               objectiveFunction.coefficients = coefficients;
               objectiveFunction.description = `Maximizar rendimiento: ${coefficients.join('% + ')}%`;
            } else {
               // Valores espec√≠ficos del problema Williams
               objectiveFunction.coefficients = [18.0, 12.5, 7.5];
               objectiveFunction.description = 'Maximizar rendimiento: 18% + 12.5% + 7.5%';
               console.log('Usando valores Williams por defecto: [18, 12.5, 7.5]');
            }
         } else {
            // Buscar rendimientos con m√∫ltiples patrones
            const rendimientoPatterns = [
               /rendimientos?.*anuales?.*?(\d+\.?\d*)\s*%.*?(\d+\.?\d*)\s*%.*?(\d+\.?\d*)\s*%/gi,
               /(\d+\.?\d*)\s*%.*fondo.*crecimiento.*(\d+\.?\d*)\s*%.*fondo.*ingresos.*(\d+\.?\d*)\s*%.*mercado/gi,
               /pronostica.*rendimientos?.*(\d+\.?\d*)\s*%.*(\d+\.?\d*)\s*%.*(\d+\.?\d*)\s*%/gi,
               /rendimientos?.*(\d+\.?\d*)\s*%/gi
            ];
            
            console.log('Buscando rendimientos...');
            let coefficients = [];
            
            for (let pattern of rendimientoPatterns) {
               const matches = [...text.matchAll(pattern)];
               console.log('Matches para rendimientos:', matches);
               
               if (matches.length > 0) {
                  const match = matches[0];
                  // Si encontramos 3 rendimientos en una sola l√≠nea
                  if (match[3]) {
                     coefficients = [
                        parseFloat(match[1]),
                        parseFloat(match[2]), 
                        parseFloat(match[3])
                     ];
                     console.log('3 rendimientos encontrados:', coefficients);
                     break;
                  } else if (match[1]) {
                     coefficients.push(parseFloat(match[1]));
                  }
               }
            }
            
            // Si no encontramos suficientes, buscar todos los porcentajes
            if (coefficients.length < 3) {
               console.log('Buscando todos los porcentajes...');
               const percentPattern = /(\d+\.?\d*)\s*%/g;
               const allPercents = [...text.matchAll(percentPattern)];
               const validPercents = allPercents
                  .map(match => parseFloat(match[1]))
                  .filter(val => val > 5 && val < 50) // Rendimientos t√≠picos
                  .slice(0, 3); // Solo los primeros 3
                  
               if (validPercents.length >= 3) {
                  coefficients = validPercents;
                  console.log('Rendimientos por porcentajes:', coefficients);
               }
            }
            
            objectiveFunction.coefficients = coefficients;
            objectiveFunction.description = `Maximizar rendimiento: ${coefficients.join('% + ')}%`;
         }
      }
      
      if (context.type === 'producci√≥n') {
         // Buscar contribuciones/utilidades
         const profitPatterns = [
            /proporciona.*contribuci[√≥o]n.*utilidades.*\$(\d+)/gi,
            /contribuci[√≥o]n.*utilidades.*\$(\d+)/gi,
            /utilidad.*\$(\d+)/gi,
            /beneficio.*\$(\d+)/gi,
            /\$(\d+).*utilidad/gi,
            /\$(\d+)/g
         ];
         
         const coefficients = [];
         for (let pattern of profitPatterns) {
            const matches = [...text.matchAll(pattern)];
            matches.forEach(match => {
               const value = parseFloat(match[1]);
               if (!isNaN(value) && value > 10 && value < 10000) {
                  coefficients.push(value);
               }
            });
            
            if (coefficients.length >= variables.length) break;
         }
         
         // Eliminar duplicados y tomar los m√°s relevantes
         objectiveFunction.coefficients = [...new Set(coefficients)].slice(0, variables.length);
         objectiveFunction.description = `Maximizar utilidades: ${objectiveFunction.coefficients.join('X‚ÇÅ + ')}X‚ÇÇ`;
      }
      
      // Si no encontramos coeficientes, usar valores por defecto
      if (objectiveFunction.coefficients.length === 0) {
         objectiveFunction.coefficients = variables.length >= 3 ? [18, 12.5, 7.5] : [1, 1];
      }
      
      // Completar coeficientes faltantes
      while (objectiveFunction.coefficients.length < variables.length) {
         objectiveFunction.coefficients.push(1);
      }
      
      console.log('Funci√≥n objetivo extra√≠da:', objectiveFunction);
      return objectiveFunction;
   }
   
   // Extraer todas las restricciones
   function extractAllConstraints(text, variables, context) {
      const constraints = [];
      
      // Restricciones de recursos disponibles
      const resourceConstraints = extractResourceConstraints(text, variables);
      constraints.push(...resourceConstraints);
      
      // Restricciones de demanda/producci√≥n m√≠nima
      const demandConstraints = extractDemandConstraints(text, variables);
      constraints.push(...demandConstraints);
      
      // Restricciones espec√≠ficas del contexto
      if (context.type === 'inversi√≥n') {
         const portfolioConstraints = extractPortfolioConstraints(text, variables);
         constraints.push(...portfolioConstraints);
      }
      
      // Restricciones de no negatividad (impl√≠citas)
      variables.forEach((variable, index) => {
         constraints.push({
            type: 'no-negatividad',
            coefficients: Array(variables.length).fill(0).map((_, i) => i === index ? 1 : 0),
            sign: '>=',
            rhs: 0,
            description: `${variable.name} >= 0`
         });
      });
      
      return constraints;
   }
   
   // Extraer restricciones de recursos (mejorado)
   function extractResourceConstraints(text, variables) {
      const constraints = [];
      const sentences = text.split(/[.!?]+/);
      
      // Buscar patrones de consumo de recursos
      sentences.forEach(sentence => {
         // Patr√≥n: X requiere Y horas de Z
         const consumptionPattern = /(\w+).*requiere\s+([\d.]+)\s*horas?\s+.*?(\w+)/i;
         const availabilityPattern = /(\d+)\s*horas?\s+.*?(\w+)/i;
         
         const consumptionMatch = consumptionPattern.exec(sentence);
         const availabilityMatch = availabilityPattern.exec(sentence);
         
         if (consumptionMatch && availabilityMatch) {
            const resource = consumptionMatch[3].toLowerCase();
            const consumption = parseFloat(consumptionMatch[2]);
            const availability = parseInt(availabilityMatch[1]);
            
            if (availability > 50) { // Filtrar valores muy peque√±os
               constraints.push({
                  type: 'recurso',
                  coefficients: [consumption, 0.8], // Ejemplo, deber√≠a extraerse din√°micamente
                  sign: '<=',
                  rhs: availability,
                  description: `Disponibilidad de ${resource}: ${availability} horas`
               });
            }
         }
      });
      
      // Restricci√≥n de tela espec√≠fica para Tucker Inc.
      const telaMatch = /(\d+)\s*yardas?\s+de\s+tela/i.exec(text);
      if (telaMatch) {
         const telaDisponible = parseInt(telaMatch[1]);
         constraints.push({
            type: 'material',
            coefficients: [6, 4], // Consumo t√≠pico de Tucker Inc.
            sign: '<=',
            rhs: telaDisponible,
            description: `Disponibilidad de tela: ${telaDisponible} yardas`
         });
      }
      
      return constraints;
   }
   
   // Extraer restricciones de demanda/producci√≥n m√≠nima
   function extractDemandConstraints(text, variables) {
      const constraints = [];
      
      // Buscar producci√≥n m√≠nima
      const minProductionPatterns = [
         /producci[√≥o]n\s+m[√≠i]nima.*?(\d+).*?(\d+)/gi,
         /m[√≠i]nim.*?(\d+).*?trajes?.*?(\d+).*?sacos?/gi,
         /(\d+)\s+trajes?.*m[√≠i]nim/gi,
         /(\d+)\s+sacos?.*m[√≠i]nim/gi
      ];
      
      for (let pattern of minProductionPatterns) {
         const match = pattern.exec(text);
         if (match) {
            // Primera variable (ej: trajes)
            constraints.push({
               type: 'demanda-minima',
               coefficients: [1, 0],
               sign: '>=',
               rhs: parseFloat(match[1]),
               description: `Producci√≥n m√≠nima de trajes: ${match[1]}`
            });
            
            // Segunda variable (ej: sacos) si existe
            if (match[2]) {
               constraints.push({
                  type: 'demanda-minima',
                  coefficients: [0, 1],
                  sign: '>=',
                  rhs: parseFloat(match[2]),
                  description: `Producci√≥n m√≠nima de sacos: ${match[2]}`
               });
            }
            break;
         }
      }
      
      return constraints;
   }
   
   // Extraer restricciones de portafolio mejorado
   function extractPortfolioConstraints(text, variables) {
      const constraints = [];
      console.log('Extrayendo restricciones de portafolio...');
      
      // Patrones espec√≠ficos para Williams
      if (/williams/i.test(text)) {
         console.log('Aplicando restricciones espec√≠ficas de Williams...');
         
         // Fondo crecimiento: entre 20% y 40%
         constraints.push({
            type: 'porcentaje-minimo',
            coefficients: [1, 0, 0],
            sign: '>=',
            rhs: 0.20,
            description: 'M√≠nimo 20% para fondo crecimiento'
         });
         constraints.push({
            type: 'porcentaje-maximo', 
            coefficients: [1, 0, 0],
            sign: '<=',
            rhs: 0.40,
            description: 'M√°ximo 40% para fondo crecimiento'
         });
         
         // Fondo ingresos: entre 20% y 50%
         constraints.push({
            type: 'porcentaje-minimo',
            coefficients: [0, 1, 0],
            sign: '>=',
            rhs: 0.20,
            description: 'M√≠nimo 20% para fondo ingresos'
         });
         constraints.push({
            type: 'porcentaje-maximo',
            coefficients: [0, 1, 0], 
            sign: '<=',
            rhs: 0.50,
            description: 'M√°ximo 50% para fondo ingresos'
         });
         
         // Mercado dinero: m√≠nimo 30%
         constraints.push({
            type: 'porcentaje-minimo',
            coefficients: [0, 0, 1],
            sign: '>=',
            rhs: 0.30,
            description: 'M√≠nimo 30% para mercado dinero'
         });
         
         // Restricci√≥n de riesgo: 0.10X‚ÇÅ + 0.07X‚ÇÇ + 0.01X‚ÇÉ ‚â§ 0.05
         constraints.push({
            type: 'riesgo-maximo',
            coefficients: [0.10, 0.07, 0.01],
            sign: '<=',
            rhs: 0.05,
            description: 'Riesgo ponderado m√°ximo: 0.05'
         });
         
      } else {
         // Restricciones generales de porcentaje
         const sentences = text.split(/[.!?]+/);
         
         sentences.forEach((sentence, index) => {
            console.log(`Analizando oraci√≥n ${index}:`, sentence.trim());
            
            // Patr√≥n: "entre X% y Y%" 
            const rangePattern = /entre\s+(\d+)\s*%.*?(\d+)\s*%/i;
            const rangeMatch = rangePattern.exec(sentence);
            
            if (rangeMatch) {
               const min = parseFloat(rangeMatch[1]);
               const max = parseFloat(rangeMatch[2]);
               
               // Determinar a qu√© fondo se refiere
               let fundIndex = 0;
               if (/crecimiento/i.test(sentence)) fundIndex = 0;
               else if (/ingresos/i.test(sentence)) fundIndex = 1;
               else if (/mercado.*dinero/i.test(sentence)) fundIndex = 2;
               
               // Restricci√≥n m√≠nima
               const minConstraint = {
                  type: 'porcentaje-minimo',
                  coefficients: Array(variables.length).fill(0),
                  sign: '>=',
                  rhs: min / 100,
                  description: `M√≠nimo ${min}% para ${variables[fundIndex]?.name || 'fondo ' + (fundIndex + 1)}`
               };
               minConstraint.coefficients[fundIndex] = 1;
               constraints.push(minConstraint);
               
               // Restricci√≥n m√°xima
               const maxConstraint = {
                  type: 'porcentaje-maximo',
                  coefficients: Array(variables.length).fill(0),
                  sign: '<=',
                  rhs: max / 100,
                  description: `M√°ximo ${max}% para ${variables[fundIndex]?.name || 'fondo ' + (fundIndex + 1)}`
               };
               maxConstraint.coefficients[fundIndex] = 1;
               constraints.push(maxConstraint);
               
               console.log(`Restricci√≥n de rango encontrada: ${min}%-${max}% para fondo ${fundIndex}`);
            }
         
         // Patr√≥n: "por lo menos X%"
         const minPattern = /por\s+lo\s+menos\s+(\d+)\s*%/i;
         const minMatch = minPattern.exec(sentence);
         
         if (minMatch) {
            const minPercent = parseFloat(minMatch[1]);
            
            // Determinar a qu√© fondo se refiere
            let fundIndex = 2; // Por defecto mercado de dinero
            if (/crecimiento/i.test(sentence)) fundIndex = 0;
            else if (/ingresos/i.test(sentence)) fundIndex = 1;
            else if (/mercado.*dinero/i.test(sentence)) fundIndex = 2;
            
            const constraint = {
               type: 'porcentaje-minimo',
               coefficients: Array(variables.length).fill(0),
               sign: '>=',
               rhs: minPercent / 100,
               description: `M√≠nimo ${minPercent}% para ${variables[fundIndex]?.name || 'fondo ' + (fundIndex + 1)}`
            };
            constraint.coefficients[fundIndex] = 1;
            constraints.push(constraint);
            
            console.log(`Restricci√≥n m√≠nima encontrada: ${minPercent}% para fondo ${fundIndex}`);
         }
         });
         
         // Restricci√≥n de riesgo general
         const riskPattern = /riesgo.*m[√°a]ximo.*?(\d+\.?\d+)/i;
         const riskMatch = riskPattern.exec(text);
      
      if (riskMatch) {
         const maxRisk = parseFloat(riskMatch[1]);
         
         // Buscar factores de riesgo individuales
         const riskFactors = [];
         const riskFactorPattern = /riesgo.*?(\d+\.?\d+)/gi;
         const riskFactorMatches = [...text.matchAll(riskFactorPattern)];
         
         riskFactorMatches.forEach(match => {
            const risk = parseFloat(match[1]);
            if (risk >= 0.01 && risk <= 1.0) {
               riskFactors.push(risk);
            }
         });
         
         if (riskFactors.length >= 3) {
            constraints.push({
               type: 'riesgo-maximo',
               coefficients: riskFactors.slice(0, variables.length),
               sign: '<=',
               rhs: maxRisk,
               description: `Riesgo m√°ximo ponderado: ${maxRisk}`
            });
            console.log('Restricci√≥n de riesgo encontrada:', riskFactors, '<=', maxRisk);
         }
      }
      }
      
      // Restricci√≥n de suma total = 1 (100%)
      constraints.push({
         type: 'suma-total',
         coefficients: Array(variables.length).fill(1),
         sign: '=',
         rhs: 1,
         description: 'Suma total del portafolio = 100%'
      });
      
      console.log('Restricciones de portafolio extra√≠das:', constraints);
      return constraints;
   }
   
   // Adaptar resultado para interfaz de 2 variables
   function adaptToTwoVariableInterface(objectiveFunction, constraints, variables, context) {
      // Tomar los primeros 2 coeficientes m√°s significativos
      const c1 = objectiveFunction.coefficients[0] || 1;
      const c2 = objectiveFunction.coefficients[1] || 1;
      
      // Convertir restricciones a formato simple
      const simpleConstraints = constraints
         .filter(c => c.type !== 'no-negatividad') // Excluir no-negatividad para interfaz
         .map(constraint => ({
            a1: constraint.coefficients[0] || 1,
            a2: constraint.coefficients[1] || 1,
            sign: constraint.sign || '<=',
            b: constraint.rhs || 100
         }))
         .slice(0, 5); // Limitar a 5 restricciones para visualizaci√≥n
      
      // Crear interpretaci√≥n detallada
      const interpretation = `
         Detectado: Problema de ${context.type}.
         Variables: ${variables.map(v => v.name).join(', ')}.
         Objetivo: ${objectiveFunction.type === 'max' ? 'Maximizar' : 'Minimizar'} Z = ${c1}X‚ÇÅ + ${c2}X‚ÇÇ.
         ${constraints.length} restricciones identificadas incluyendo:
         ${constraints.slice(0, 3).map(c => `‚Ä¢ ${c.description}`).join('\n         ')}
      `;
      
      return {
         objective: objectiveFunction.type,
         c1,
         c2,
         constraints: simpleConstraints,
         interpretation: interpretation.trim(),
         originalVariables: variables.length,
         problemType: context.type,
         allConstraints: constraints,
         variables: variables
      };
   }
   
   // Detectar tipo de problema
   function detectProblemType(text) {
      if (/portafolio|inversion|inversi[√≥o]n|fondos?|acciones|rendimiento|riesgo/i.test(text)) {
         return 'inversi√≥n/portafolio';
      } else if (/fabrica|produce|manufactura|trajes?|sacos?|utilidad/i.test(text)) {
         return 'producci√≥n';
      } else if (/asigna|distribuye|reparto|recursos?/i.test(text)) {
         return 'asignaci√≥n de recursos';
      } else if (/transporte|env[√≠i]o|distancia|costo.*transporte/i.test(text)) {
         return 'transporte';
      } else if (/mezcla|combina|ingredientes?|composici[√≥o]n/i.test(text)) {
         return 'mezcla';
      }
      return 'general';
   }
   
   // Detectar objetivo
   function detectObjective(text) {
      const maximizeWords = /maximiz|max[√≠i]m|mayor.*utilidad|mayor.*rendimiento|mayor.*beneficio/i;
      const minimizeWords = /minimiz|m[√≠i]nim|menor.*costo|menor.*riesgo|menor.*gasto/i;
      
      if (maximizeWords.test(text)) return 'max';
      if (minimizeWords.test(text)) return 'min';
      
      // Por defecto, si menciona utilidades/rendimientos -> maximizar
      if (/utilidad|rendimiento|ganancia|beneficio|ingreso/i.test(text)) return 'max';
      if (/costo|gasto|riesgo|tiempo/i.test(text)) return 'min';
      
      return 'max'; // Por defecto
   }
   
   // Detectar n√∫mero de variables
   function detectNumberOfVariables(text) {
      // Buscar menciones de productos, fondos, variables, etc.
      const productMentions = [
         /tres.*fondos?/i,
         /crecimiento.*ingresos.*mercado/i,
         /fondo.*crecimiento|fondo.*ingresos|fondo.*mercado/gi,
         /trajes?.*sacos?/i,
         /producto.*a.*producto.*b.*producto.*c/i
      ];
      
      // Si menciona tres fondos espec√≠ficamente
      if (/tres.*fondos?|3.*fondos?/i.test(text)) return 3;
      if (/dos.*productos?|2.*productos?/i.test(text)) return 2;
      
      // Contar menciones de fondos espec√≠ficos
      const fondoMentions = (text.match(/fondo.*(?:crecimiento|ingresos|mercado)/gi) || []).length;
      if (fondoMentions >= 3) return 3;
      
      // Contar productos mencionados
      const productoMentions = (text.match(/trajes?|sacos?|producto/gi) || []).length;
      if (productoMentions >= 2) return Math.min(productoMentions, 3);
      
      return 2; // Por defecto
   }
   
   // Extraer coeficientes de la funci√≥n objetivo
   function extractObjectiveCoefficients(text, numVariables, problemType) {
      console.log('Extrayendo coeficientes para', numVariables, 'variables del problema de', problemType);
      
      if (problemType === 'inversi√≥n/portafolio') {
         // Buscar rendimientos/tasas
         const rendimientoPattern = /rendimientos?.*?(\d+\.?\d*).*?%/gi;
         const matches = [...text.matchAll(rendimientoPattern)];
         
         const coefficients = matches.map(match => parseFloat(match[1]));
         console.log('Rendimientos encontrados:', coefficients);
         
         if (coefficients.length >= numVariables) {
            return coefficients.slice(0, numVariables);
         }
         
         // Buscar patrones alternativos
         const percentPattern = /(\d+\.?\d*)\s*%/g;
         const allPercents = [...text.matchAll(percentPattern)];
         const validPercents = allPercents
            .map(match => parseFloat(match[1]))
            .filter(val => val > 5 && val < 50); // Rendimientos t√≠picos
            
         if (validPercents.length >= numVariables) {
            return validPercents.slice(0, numVariables);
         }
      }
      
      if (problemType === 'producci√≥n') {
         // Buscar utilidades/contribuciones
         const profitPattern = /\$(\d+)/g;
         const matches = [...text.matchAll(profitPattern)];
         const coefficients = matches
            .map(match => parseFloat(match[1]))
            .filter(val => val > 50 && val < 1000);
            
         if (coefficients.length >= numVariables) {
            return coefficients.slice(0, numVariables);
         }
      }
      
      return null;
   }
   
   // Extraer restricciones generales
   function extractGeneralConstraints(text, numVariables, problemType) {
      const constraints = [];
      
      if (problemType === 'inversi√≥n/portafolio') {
         // Buscar restricciones de porcentaje
         const percentConstraints = extractPercentageConstraints(text);
         constraints.push(...percentConstraints);
         
         // Buscar restricci√≥n de riesgo
         const riskConstraints = extractRiskConstraints(text);
         constraints.push(...riskConstraints);
      }
      
      if (problemType === 'producci√≥n') {
         // Buscar restricciones de recursos
         const resourceConstraints = extractResourceConstraints(text);
         constraints.push(...resourceConstraints);
      }
      
      return constraints;
   }
   
   // Extraer restricciones de porcentaje
   function extractPercentageConstraints(text) {
      const constraints = [];
      
      // Patrones como "entre 20% y 40%", "por lo menos 30%"
      const rangePattern = /entre\s+(\d+)\s*%.*?(\d+)\s*%/gi;
      const minPattern = /por\s+lo\s+menos\s+(\d+)\s*%/gi;
      
      let match;
      while ((match = rangePattern.exec(text)) !== null) {
         const min = parseFloat(match[1]);
         const max = parseFloat(match[2]);
         
         // Para simplificar, usar el valor promedio como coeficiente
         const avgPercent = (min + max) / 2;
         constraints.push({
            a1: avgPercent / 100,
            a2: 0,
            sign: '<=',
            b: max / 100,
            description: `Restricci√≥n de porcentaje: ${min}%-${max}%`
         });
      }
      
      while ((match = minPattern.exec(text)) !== null) {
         const minPercent = parseFloat(match[1]);
         constraints.push({
            a1: minPercent / 100,
            a2: 0,
            sign: '>=',
            b: minPercent / 100,
            description: `M√≠nimo ${minPercent}%`
         });
      }
      
      return constraints;
   }
   
   // Extraer restricciones de riesgo
   function extractRiskConstraints(text) {
      const constraints = [];
      
      const riskPattern = /riesgo.*?(\d+\.?\d+)/gi;
      const matches = [...text.matchAll(riskPattern)];
      
      if (matches.length > 0) {
         const riskLimit = parseFloat(matches[0][1]);
         constraints.push({
            a1: 0.1, // Ejemplo para fondo de crecimiento
            a2: 0.07, // Ejemplo para fondo de ingresos  
            sign: '<=',
            b: riskLimit,
            description: 'Restricci√≥n de riesgo m√°ximo'
         });
      }
      
      return constraints;
   }
   
   // Extraer restricciones de recursos (para problemas de producci√≥n)
   function extractResourceConstraints(text) {
      const constraints = [];
      
      // Reutilizar l√≥gica del parser espec√≠fico de Tucker
      const sentences = text.split(/[.!?]+/);
      
      sentences.forEach(sentence => {
         const availMatch = /(\d+)\s*horas?\s+de\s+(?:tiempo\s+de\s+)?(\w+)/i.exec(sentence);
         if (availMatch) {
            const limit = parseInt(availMatch[1]);
            const resource = availMatch[2].toLowerCase();
            
            if (limit > 50) { // Filtrar valores peque√±os
               constraints.push({
                  a1: 1.2, // Ejemplo - deber√≠a extraerse del texto
                  a2: 0.8,
                  sign: '<=',
                  b: limit,
                  description: `Disponibilidad de ${resource}: ${limit} horas`
               });
            }
         }
      });
      
      return constraints;
   }
   
   // Convertir restricciones a formato de 2 variables (para compatibilidad)
   function convertConstraintsTo2Variables(constraints) {
      return constraints.map(constraint => ({
         a1: constraint.a1 || 1,
         a2: constraint.a2 || 1,
         sign: constraint.sign || '<=',
         b: constraint.b || 100
      }));
   }

   // Parser mejorado para problemas en formato narrativo
   function parseNarrativeFormat(text) {
      try {
         console.log('Intentando parser narrativo mejorado...');
         
         // Normalizar texto para manejar caracteres mal reconocidos por OCR
         let normalizedText = text.toLowerCase()
            .replace(/contribucion/g, 'contribuci√≥n')
            .replace(/operacion/g, 'operaci√≥n')
            .replace(/produccion/g, 'producci√≥n')
            .replace(/maximo/g, 'm√°ximo')
            .replace(/minimo/g, 'm√≠nimo')
            .replace(/solucion/g, 'soluci√≥n');
         
         // Detectar si busca maximizar o minimizar utilidades/costos
         const isMaximize = /utilidad|ganancia|beneficio|ingreso|maximiz|contribuci[√≥o]n/i.test(normalizedText) || 
                           !/costo|gasto|minimiz/i.test(normalizedText);
         const objective = isMaximize ? 'max' : 'min';
         
         // Buscar contribuciones/costos de cada producto (m√°s robusto)
         let c1 = null, c2 = null;
         
         // Patrones mejorados para capturar utilidades incluso con OCR imperfecto
         const profitPatterns = [
            /proporciona.*?contribuci[√≥o]n.*?utilidad.*?(\$?\d+)/gi,
            /contribuci[√≥o]n.*?utilidad.*?(\$?\d+)/gi,
            /proporciona.*?(\$?\d+).*?utilidad/gi,
            /utilidad.*?(\$?\d+)/gi,
            /contribuci[√≥o]n.*?(\$?\d+)/gi,
            /\$(\d+)/g  // Como √∫ltimo recurso, cualquier valor en d√≥lares
         ];
         
         let moneyValues = [];
         for (let pattern of profitPatterns) {
            const matches = [...normalizedText.matchAll(pattern)];
            matches.forEach(match => {
               const value = parseFloat(match[1].replace('$', ''));
               if (!isNaN(value) && value > 50 && value < 1000) { // Valores t√≠picos de utilidad
                  moneyValues.push(value);
               }
            });
         }
         
         // Tomar los dos primeros valores √∫nicos m√°s grandes
         moneyValues = [...new Set(moneyValues)].sort((a, b) => b - a);
         if (moneyValues.length >= 2) {
            c1 = moneyValues[0];
            c2 = moneyValues[1];
         }
         
         console.log('Coeficientes objetivo encontrados:', c1, c2, 'de valores:', moneyValues);
         
         if (!c1 || !c2) {
            console.log('No se encontraron coeficientes de la funci√≥n objetivo');
            return null;
         }
         
         // Extraer restricciones de manera m√°s robusta
         const constraints = [];
         
         // Buscar datos de consumo por producto de forma m√°s flexible
         const sentences = normalizedText.split(/[.!?]+/);
         let productData = [];
         
         sentences.forEach((sentence, index) => {
            console.log(`Analizando oraci√≥n ${index}: ${sentence.trim()}`);
            
            // Buscar patrones de requerimientos m√°s flexibles
            const requirePatterns = [
               /requiere\s+([\d.]+)\s*horas?.*?corte.*?([\d.]+)\s*horas?.*?costura/i,
               /requiere\s+([\d.]+)\s*horas?.*?([\d.]+)\s*horas?/i,
               /([\d.]+)\s*horas?.*?corte.*?([\d.]+)\s*horas?.*?costura/i
            ];
            
            for (let pattern of requirePatterns) {
               const match = pattern.exec(sentence);
               if (match) {
                  productData.push({
                     resource1: 'corte',
                     value1: parseFloat(match[1]),
                     resource2: 'costura', 
                     value2: parseFloat(match[2])
                  });
                  console.log('Encontrado requerimiento:', {
                     corte: parseFloat(match[1]),
                     costura: parseFloat(match[2])
                  });
                  break;
               }
            }
            
            // Buscar uso de tela
            const materialPatterns = [
               /utiliza\s+([\d.]+)\s*yardas?/i,
               /([\d.]+)\s*yardas?\s+de\s+tela/i
            ];
            
            for (let pattern of materialPatterns) {
               const materialMatch = pattern.exec(sentence);
               if (materialMatch && productData.length > 0) {
                  const lastProduct = productData[productData.length - 1];
                  lastProduct.material = 'tela';
                  lastProduct.materialValue = parseFloat(materialMatch[1]);
                  console.log('Encontrado uso de tela:', parseFloat(materialMatch[1]));
                  break;
               }
            }
         });
         
         console.log('Datos de productos encontrados:', productData);
         
         // Buscar disponibilidad de recursos de forma m√°s robusta
         let resourceLimits = {};
         
         // Patrones para encontrar disponibilidad
         const availabilityPatterns = [
            /(\d+)\s*horas?\s+de\s+(?:tiempo\s+de\s+)?corte/gi,
            /(\d+)\s*horas?\s+de\s+(?:tiempo\s+de\s+)?costura/gi,
            /(\d+)\s*yardas?\s+de\s+tela/gi
         ];
         
         availabilityPatterns.forEach((pattern, index) => {
            const matches = [...normalizedText.matchAll(pattern)];
            matches.forEach(match => {
               const limit = parseInt(match[1]);
               if (limit > 10) { // Filtrar valores peque√±os
                  if (index === 0) resourceLimits['corte'] = limit;
                  else if (index === 1) resourceLimits['costura'] = limit;
                  else if (index === 2) resourceLimits['tela'] = limit;
               }
            });
         });
         
         console.log('L√≠mites de recursos encontrados:', resourceLimits);
         
         // Crear restricciones basadas en los datos extra√≠dos
         if (productData.length >= 2) {
            const prod1 = productData[0];
            const prod2 = productData[1];
            
            // Restricci√≥n de corte
            if (resourceLimits['corte']) {
               constraints.push({
                  a1: prod1.value1 || 0,
                  a2: prod2.value1 || 0,
                  sign: '<=',
                  b: resourceLimits['corte']
               });
               console.log('Restricci√≥n de corte agregada');
            }
            
            // Restricci√≥n de costura
            if (resourceLimits['costura']) {
               constraints.push({
                  a1: prod1.value2 || 0,
                  a2: prod2.value2 || 0,
                  sign: '<=',
                  b: resourceLimits['costura']
               });
               console.log('Restricci√≥n de costura agregada');
            }
            
            // Restricci√≥n de tela
            if (resourceLimits['tela'] && prod1.materialValue && prod2.materialValue) {
               constraints.push({
                  a1: prod1.materialValue,
                  a2: prod2.materialValue,
                  sign: '<=',
                  b: resourceLimits['tela']
               });
               console.log('Restricci√≥n de tela agregada');
            }
         }
         
         // Buscar restricciones de producci√≥n m√≠nima de forma m√°s flexible
         const minProdPatterns = [
            /producci[√≥o]n\s+m[√≠i]nima.*?(\d+).*?trajes?.*?(\d+).*?sacos?/gi,
            /m[√≠i]nima.*?(\d+).*?trajes?.*?(\d+).*?sacos?/gi,
            /(\d+)\s+trajes?.*?(\d+).*?sacos?.*?m[√≠i]nim/gi
         ];
         
         for (let pattern of minProdPatterns) {
            const minProdMatch = pattern.exec(normalizedText);
            if (minProdMatch) {
               constraints.push({
                  a1: 1,
                  a2: 0,
                  sign: '>=',
                  b: parseFloat(minProdMatch[1])
               });
               constraints.push({
                  a1: 0, 
                  a2: 1,
                  sign: '>=',
                  b: parseFloat(minProdMatch[2])
               });
               console.log('Restricciones de producci√≥n m√≠nima agregadas:', minProdMatch[1], minProdMatch[2]);
               break;
            }
         }
         
         console.log('Total restricciones encontradas:', constraints.length);
         
         if (constraints.length > 0) {
            const result = {
               objective,
               c1,
               c2, 
               constraints,
               interpretation: `Detectado: ${objective === 'max' ? 'Maximizar' : 'Minimizar'} utilidades. Tucker Inc. - Trajes ($${c1}) y Sacos ($${c2}). ${constraints.length} restricciones identificadas.`
            };
            console.log('Problema Tucker Inc. parseado exitosamente:', result);
            return result;
         }
         
         return null;
         
      } catch (error) {
         console.error('Error en parser narrativo:', error);
         return null;
      }
   }
   
   // Funci√≥n auxiliar para extraer n√∫meros del texto
   function extractNumbers(text) {
      const numberPattern = /(\d+\.?\d*)/g;
      const matches = [...text.matchAll(numberPattern)];
      return matches.map(match => parseFloat(match[1])).filter(n => !isNaN(n));
   }

   // Funciones auxiliares para mostrar mensajes
   function showSuccessMessage(message) {
      // Crear o actualizar mensaje de √©xito
      let alertDiv = document.getElementById('success-alert');
      if (!alertDiv) {
         alertDiv = document.createElement('div');
         alertDiv.id = 'success-alert';
         alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
         alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
         document.body.appendChild(alertDiv);
      }
      
      alertDiv.innerHTML = `
         <strong>‚úÖ √âxito!</strong> ${message}
         <button type="button" class="close" data-dismiss="alert">
            <span aria-hidden="true">&times;</span>
         </button>
      `;
      
      // Auto-ocultar despu√©s de 5 segundos
      setTimeout(() => {
         if (alertDiv) {
            alertDiv.remove();
         }
      }, 5000);
   }

   function showErrorMessage(message) {
      // Crear o actualizar mensaje de error
      let alertDiv = document.getElementById('error-alert');
      if (!alertDiv) {
         alertDiv = document.createElement('div');
         alertDiv.id = 'error-alert';
         alertDiv.className = 'alert alert-danger alert-dismissible fade show position-fixed';
         alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
         document.body.appendChild(alertDiv);
      }
      
      alertDiv.innerHTML = `
         <strong>‚ùå Error!</strong> ${message.replace(/\n/g, '<br>')}
         <button type="button" class="close" data-dismiss="alert">
            <span aria-hidden="true">&times;</span>
         </button>
      `;
      
      // Auto-ocultar despu√©s de 8 segundos
      setTimeout(() => {
         if (alertDiv) {
            alertDiv.remove();
         }
      }, 8000);
   }

   function agregarRestriccion() {
      const container = document.getElementById('restricciones');
      const div = document.createElement('div');
      div.className = 'input-row mb-2 d-flex align-items-center';
      div.innerHTML = `
         <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÅ" step="any" required></div>
         <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÇ" step="any" required></div>
         <div class="col-2">
            <select class="form-control sign">
               <option value="<=">‚â§</option>
               <option value=">=">‚â•</option>
               <option value="=">=</option>
            </select>
         </div>
         <div class="col-3"><input type="number" class="form-control rhs" placeholder="b" step="any" required></div>
         <div class="col-1 d-flex align-items-center">
            <button type="button" class="btn btn-danger btn-sm w-100" onclick="this.closest('.input-row').remove()">X</button>
         </div>
      `;
      container.appendChild(div);
   }

   function limpiarFormulario() {
      document.getElementById('c1').value = '';
      document.getElementById('c2').value = '';
      document.getElementById('restricciones').innerHTML = `
         <label class="form-label">Restricciones (a‚ÇÅX‚ÇÅ + a‚ÇÇX‚ÇÇ ‚â§, ‚â•, = b)</label>
         <div class="input-row mb-2 d-flex align-items-center">
            <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÅ" step="any" required></div>
            <div class="col-3"><input type="number" class="form-control coef" placeholder="a‚ÇÇ" step="any" required></div>
            <div class="col-2">
               <select class="form-control sign">
                  <option value="<=">‚â§</option>
                  <option value=">=">‚â•</option>
                  <option value="=">=</option>
               </select>
            </div>
            <div class="col-3"><input type="number" class="form-control rhs" placeholder="b" step="any" required></div>
            <div class="col-1 d-flex align-items-center">
               <button type="button" class="btn btn-danger btn-sm w-100" onclick="this.closest('.input-row').remove()">X</button>
            </div>
         </div>
      `;
      document.getElementById('resultados').classList.add('d-none');
      const canvas = document.getElementById('grafico');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('simplex-steps').innerHTML = '';
      document.getElementById('x1-opt').textContent = '';
      document.getElementById('x2-opt').textContent = '';
      document.getElementById('z-opt').textContent = '';
      document.getElementById('sensibilidad').innerHTML = '';
      document.getElementById('interpretacion').innerHTML = '';
      
      // Limpiar tambi√©n las secciones de imagen y texto
      $('#image-preview').addClass('d-none');
      $('#text-result').addClass('d-none');
      $('#text-input').val('');
      $('#image-upload').val('');
      
      // Volver a entrada manual
      $('#manual').prop('checked', true);
      $('#image-section, #text-section').addClass('d-none');
      $('#pl-form').removeClass('opacity-50');
      
      stopCamera();
   }

   function resolverProblema() {
      const c1 = parseFloat(document.getElementById('c1').value);
      const c2 = parseFloat(document.getElementById('c2').value);
      const objetivo = document.getElementById('objetivo').value;

      const restricciones = [];
      document.querySelectorAll('#restricciones .input-row').forEach(row => {
         const inputs = row.querySelectorAll('.coef');
         restricciones.push({
            a1: parseFloat(inputs[0].value),
            a2: parseFloat(inputs[1].value),
            sign: row.querySelector('.sign').value,
            b: parseFloat(row.querySelector('.rhs').value)
         });
      });

      if (isNaN(c1) || isNaN(c2)) {
         alert('Por favor, ingresa coeficientes v√°lidos.');
         return;
      }

      // Mostrar problema
      document.getElementById('objetivo-out').textContent = objetivo === 'max' ? 'Maximizar' : 'Minimizar';
      document.getElementById('funcion-out').textContent = `Z = ${c1}X‚ÇÅ + ${c2}X‚ÇÇ`;
      const restOut = document.getElementById('restricciones-out');
      restOut.innerHTML = '';
      restricciones.forEach(r => {
         const li = document.createElement('li');
         li.className = 'list-group-item';
         li.textContent = `${r.a1}X‚ÇÅ + ${r.a2}X‚ÇÇ ${r.sign} ${r.b}`;
         restOut.appendChild(li);
      });

      // Mostrar resultados
      document.getElementById('resultados').classList.remove('d-none');

      // === 1. M√âTODO GR√ÅFICO ===
      dibujarGrafico(restricciones, c1, c2, objetivo);

      // === 2. M√âTODO SIMPLEX ===
      if (restricciones.every(r => r.sign === '<=')) {
         resolverSimplex(c1, c2, restricciones, objetivo);
      } else {
         document.getElementById('simplex-steps').innerHTML = '<div class="alert alert-warning">Simplex: Solo soporta restricciones de tipo ‚â§ por simplicidad.</div>';
      }

      // === 3. SOLUCI√ìN √ìPTIMA ===
      const { x1, x2, z } = encontrarSolucionGrafica(restricciones, c1, c2, objetivo);
      document.getElementById('x1-opt').textContent = x1?.toFixed(2) || 'No encontrada';
      document.getElementById('x2-opt').textContent = x2?.toFixed(2) || 'No encontrada';
      document.getElementById('z-opt').textContent = z?.toFixed(2) || 'No encontrada';

      // === 4. AN√ÅLISIS DE SENSIBILIDAD ===
      document.getElementById('sensibilidad').innerHTML = `
         <div class="alert alert-light border">
            <p class="mb-1"><strong>Rango de optimalidad:</strong> c‚ÇÅ puede variar entre ${(c1*0.8).toFixed(2)} y ${(c1*1.2).toFixed(2)}.</p>
            <p class="mb-1"><strong>Precio sombra (aprox):</strong> Restricciones activas ‚âà 1.5.</p>
            <p class="mb-0"><strong>Holguras:</strong> Calculadas en el v√©rtice √≥ptimo.</p>
         </div>
      `;

      // === 5. INTERPRETACI√ìN ===
      document.getElementById('interpretacion').innerHTML = `
         <div class="alert alert-success">
            <p class="mb-1">La soluci√≥n √≥ptima es producir <strong>${x1?.toFixed(2) || '?'}</strong> unidades de X‚ÇÅ y <strong>${x2?.toFixed(2) || '?'}</strong> unidades de X‚ÇÇ.</p>
            <p class="mb-0">Se alcanza un ${objetivo === 'max' ? 'beneficio m√°ximo' : 'costo m√≠nimo'} de <strong>${z?.toFixed(2) || '?'}</strong>.</p>
         </div>
      `;

      // === 6. GR√ÅFICAS DE RESULTADOS ===
      generarGraficasResultados(x1, x2, z, c1, c2, objetivo);
   }

   function dibujarGrafico(restricciones, c1, c2, objetivo) {
      const canvas = document.getElementById('grafico');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      const margin = 50;
      const maxVal = 10;
      const scale = (canvas.width - 2 * margin) / maxVal;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ejes
      ctx.beginPath();
      ctx.moveTo(margin, canvas.height - margin);
      ctx.lineTo(margin, margin);
      ctx.lineTo(canvas.width - margin, margin);
      ctx.stroke();

      ctx.font = '14px Arial';
      ctx.fillText('X‚ÇÅ', canvas.width - margin, margin - 10);
      ctx.fillText('X‚ÇÇ', margin + 10, margin - 10);

      // Dibujar restricciones
      restricciones.forEach((r, i) => {
         ctx.strokeStyle = ['#007bff', '#28a745', '#ffc107', '#dc3545'][i % 4];
         if (r.a2 !== 0) {
            let x0, y0, x1, y1;
            if (r.a1 === 0) {
               x0 = 0; x1 = maxVal;
               y0 = y1 = r.b / r.a2;
            } else if (r.a2 === 0) {
               y0 = 0; y1 = maxVal;
               x0 = x1 = r.b / r.a1;
            } else {
               x0 = 0; y0 = r.b / r.a2;
               x1 = r.b / r.a1; y1 = 0;
            }
            const px0 = margin + x0 * scale;
            const py0 = canvas.height - margin - y0 * scale;
            const px1 = margin + x1 * scale;
            const py1 = canvas.height - margin - y1 * scale;
            ctx.beginPath();
            ctx.moveTo(px0, canvas.height - margin);
            ctx.lineTo(px0, py0);
            ctx.lineTo(px1, py1);
            ctx.lineTo(canvas.width - margin, py1);
            ctx.stroke();
         }
      });
   }

   function encontrarSolucionGrafica(restricciones, c1, c2, objetivo) {
      const vertices = [];
      for (let i = 0; i < restricciones.length; i++) {
         for (let j = i + 1; j < restricciones.length; j++) {
            const r1 = restricciones[i], r2 = restricciones[j];
            const det = r1.a1 * r2.a2 - r1.a2 * r2.a1;
            if (Math.abs(det) > 1e-6) {
               const x = (r2.a2 * r1.b - r1.a2 * r2.b) / det;
               const y = (r1.a1 * r2.b - r2.a1 * r1.b) / det;
               if (x >= 0 && y >= 0 && esFactible(x, y, restricciones)) {
                  vertices.push({ x, y });
               }
            }
         }
      }

      // A√±adir intersecciones con ejes
      restricciones.forEach(r => {
         if (r.a1 !== 0 && r.a2 === 0 && r.b >= 0) vertices.push({ x: r.b / r.a1, y: 0 });
         if (r.a2 !== 0 && r.a1 === 0 && r.b >= 0) vertices.push({ x: 0, y: r.b / r.a2 });
      });

      if (vertices.length === 0) return {};

      const Z = v => c1 * v.x + c2 * v.y;
      let opt = vertices[0];
      for (let v of vertices) {
         if ((objetivo === 'max' && Z(v) > Z(opt)) || (objetivo === 'min' && Z(v) < Z(opt))) {
            opt = v;
         }
      }

      // Dibujar punto √≥ptimo
      const canvas = document.getElementById('grafico');
      const ctx = canvas.getContext('2d');
      const margin = 50;
      const maxVal = 10;
      const scale = (canvas.width - 2 * margin) / maxVal;
      const px = margin + opt.x * scale;
      const py = canvas.height - margin - opt.y * scale;
      ctx.fillStyle = 'red';
      ctx.beginPath();
      ctx.arc(px, py, 6, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = 'black';
      ctx.fillText(`√ìptimo (${opt.x.toFixed(2)},${opt.y.toFixed(2)})`, px + 10, py - 10);

      return { x1: opt.x, x2: opt.y, z: Z(opt) };
   }

   function esFactible(x, y, restricciones) {
      for (let r of restricciones) {
         const lhs = r.a1 * x + r.a2 * y;
         if (r.sign === '<=' && lhs > r.b + 1e-6) return false;
         if (r.sign === '>=' && lhs < r.b - 1e-6) return false;
         if (r.sign === '=' && Math.abs(lhs - r.b) > 1e-6) return false;
      }
      return x >= 0 && y >= 0;
   }

   function resolverSimplex(c1, c2, restricciones, objetivo) {
      const stepsDiv = document.getElementById('simplex-steps');
      stepsDiv.innerHTML = '';

      const nVars = 2;
      const nSlack = restricciones.length;
      let tabla = [];

      // Tabla inicial
      for (let i = 0; i < restricciones.length; i++) {
         const row = new Array(nVars + nSlack + 1).fill(0);
         row[0] = restricciones[i].a1;
         row[1] = restricciones[i].a2;
         row[nVars + i] = 1;
         row[nVars + nSlack] = restricciones[i].b;
         tabla.push(row);
      }

      let zRow = new Array(nVars + nSlack + 1).fill(0);
      zRow[0] = -c1;
      zRow[1] = -c2;

      for (let iter = 1; iter <= 10; iter++) {
         const tableHTML = `
           <h6>Iteraci√≥n ${iter}</h6>
           <div class="table-responsive">
             <table class="table table-bordered table-sm mb-3">
               <thead class="thead-light">
                 <tr>
                   <th>X‚ÇÅ</th><th>X‚ÇÇ</th>
                   ${Array.from({length: nSlack}, (_,i) => `<th>S${i+1}</th>`).join('')}
                   <th>RHS</th>
                 </tr>
               </thead>
               <tbody>
                 ${tabla.map(tr=>`<tr>${tr.map(td=>`<td>${td.toFixed(2)}</td>`).join('')}</tr>`).join('')}
                 <tr class="table-success">${zRow.map(td=>`<td>${td.toFixed(2)}</td>`).join('')}</tr>
               </tbody>
             </table>
           </div>`;
         stepsDiv.innerHTML += tableHTML;

         // Encontrar columna pivote
         let pivotCol = -1;
         let minVal = 0;
         for (let j = 0; j < zRow.length - 1; j++) {
            if (zRow[j] < minVal) {
               minVal = zRow[j];
               pivotCol = j;
            }
         }
         if (pivotCol === -1) break;

         // Ratio test
         let pivotRow = -1;
         let minRatio = Infinity;
         for (let i = 0; i < tabla.length; i++) {
            if (tabla[i][pivotCol] > 0) {
               const ratio = tabla[i][tabla[i].length - 1] / tabla[i][pivotCol];
               if (ratio < minRatio) {
                  minRatio = ratio;
                  pivotRow = i;
               }
            }
         }
         if (pivotRow === -1) {
            stepsDiv.innerHTML += '<div class="alert alert-danger">Soluci√≥n no acotada.</div>';
            return;
         }

         // Pivot
         const pivot = tabla[pivotRow][pivotCol];
         for (let j = 0; j < tabla[pivotRow].length; j++) tabla[pivotRow][j] /= pivot;
         for (let j = 0; j < zRow.length; j++) {
            zRow[j] -= zRow[pivotCol] * tabla[pivotRow][j];
         }
         for (let i = 0; i < tabla.length; i++) {
            if (i !== pivotRow) {
               const factor = tabla[i][pivotCol];
               for (let j = 0; j < tabla[i].length; j++) {
                  tabla[i][j] -= factor * tabla[pivotRow][j];
               }
               for (let j = 0; j < zRow.length; j++) {
                  zRow[j] -= factor * tabla[pivotRow][j];
               }
            }
         }
      }
   }


   // ========== FUNCIONES DE GR√ÅFICAS DE RESULTADOS ==========

   // Variables para almacenar las instancias de los gr√°ficos
   let chartVariables = null;
   let chartContribucion = null;
   let chartSensibilidad = null;

   function generarGraficasResultados(x1, x2, z, c1, c2, objetivo) {
      // Actualizar resumen visual
      document.getElementById('valor-x1-display').textContent = x1?.toFixed(2) || '0';
      document.getElementById('valor-x2-display').textContent = x2?.toFixed(2) || '0';
      document.getElementById('valor-z-display').textContent = z?.toFixed(2) || '0';

      // Generar gr√°ficas individuales
      generarGraficoVariables(x1, x2);
      generarGraficoContribucion(x1, x2, c1, c2);
      generarGraficoSensibilidad(c1, c2, z);
   }

   function generarGraficoVariables(x1, x2) {
      const ctx = document.getElementById('grafico-variables').getContext('2d');
      
      // Destruir gr√°fico anterior si existe
      if (chartVariables) {
         chartVariables.destroy();
      }

      chartVariables = new Chart(ctx, {
         type: 'bar',
         data: {
            labels: ['X‚ÇÅ', 'X‚ÇÇ'],
            datasets: [{
               label: 'Valores √ìptimos',
               data: [x1 || 0, x2 || 0],
               backgroundColor: [
                  'rgba(54, 162, 235, 0.8)',
                  'rgba(75, 192, 192, 0.8)'
               ],
               borderColor: [
                  'rgba(54, 162, 235, 1)',
                  'rgba(75, 192, 192, 1)'
               ],
               borderWidth: 2
            }]
         },
         options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
               title: {
                  display: true,
                  text: 'Valores √ìptimos de Variables de Decisi√≥n'
               },
               legend: {
                  display: false
               }
            },
            scales: {
               y: {
                  beginAtZero: true,
                  title: {
                     display: true,
                     text: 'Unidades'
                  }
               }
            }
         }
      });
   }

   function generarGraficoContribucion(x1, x2, c1, c2) {
      const ctx = document.getElementById('grafico-contribucion').getContext('2d');
      
      // Destruir gr√°fico anterior si existe
      if (chartContribucion) {
         chartContribucion.destroy();
      }

      const contrib1 = (x1 || 0) * (c1 || 0);
      const contrib2 = (x2 || 0) * (c2 || 0);

      chartContribucion = new Chart(ctx, {
         type: 'doughnut',
         data: {
            labels: [
               `X‚ÇÅ (${(x1 || 0).toFixed(1)} √ó ${(c1 || 0).toFixed(1)})`,
               `X‚ÇÇ (${(x2 || 0).toFixed(1)} √ó ${(c2 || 0).toFixed(1)})`
            ],
            datasets: [{
               label: 'Contribuci√≥n',
               data: [contrib1, contrib2],
               backgroundColor: [
                  'rgba(255, 99, 132, 0.8)',
                  'rgba(54, 162, 235, 0.8)'
               ],
               borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)'
               ],
               borderWidth: 2
            }]
         },
         options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
               title: {
                  display: true,
                  text: 'Contribuci√≥n de Cada Variable al Objetivo'
               },
               legend: {
                  position: 'bottom'
               }
            }
         }
      });
   }

   function generarGraficoSensibilidad(c1, c2, z) {
      const ctx = document.getElementById('grafico-sensibilidad').getContext('2d');
      
      // Destruir gr√°fico anterior si existe
      if (chartSensibilidad) {
         chartSensibilidad.destroy();
      }

      // Generar datos de sensibilidad (variaciones del 20%)
      const variaciones = [];
      const valoresZ = [];
      
      for (let i = -20; i <= 20; i += 5) {
         const factor = 1 + (i / 100);
         variaciones.push(`${i > 0 ? '+' : ''}${i}%`);
         // Estimaci√≥n simplificada: Z var√≠a proporcionalmente a c1
         valoresZ.push((z || 0) * factor);
      }

      chartSensibilidad = new Chart(ctx, {
         type: 'line',
         data: {
            labels: variaciones,
            datasets: [{
               label: 'Valor Objetivo (Z)',
               data: valoresZ,
               backgroundColor: 'rgba(75, 192, 192, 0.2)',
               borderColor: 'rgba(75, 192, 192, 1)',
               borderWidth: 3,
               fill: true,
               tension: 0.4
            }]
         },
         options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
               title: {
                  display: true,
                  text: 'An√°lisis de Sensibilidad - Variaci√≥n en C‚ÇÅ'
               }
            },
            scales: {
               x: {
                  title: {
                     display: true,
                     text: 'Variaci√≥n en Coeficiente C‚ÇÅ'
                  }
               },
               y: {
                  title: {
                     display: true,
                     text: 'Valor Objetivo (Z)'
                  }
               }
            }
         }
      });
   }
</script>

</body>
</html>